function textEvents(){$("span.name").live("keydown",function(a){if(a.keyCode===13){a.preventDefault();$(this).blur()}});$("span.name").live("blur",function(){$(this).saveChanges()})}function getQueryParams(){var a=document.location.search;a=a.split("+").join(" ");var b={},c,d=/[?&]?([^=]+)=([^&]*)/g;while(c=d.exec(a))b[decodeURIComponent(c[1])]=decodeURIComponent(c[2]);return b}function menuClickEvents(){$("#btnText").click(function(){if($("#left").is(":visible")){$("#left, #left2").fadeOut("fast");$(this).text("Show Text")}else{$("#left, #left2").fadeIn("fast");$(this).text("Hide Text")}});$("#btnGraphics").click(function(){if($("#right").is(":visible")){$("#right").hide();$(this).text("Show Graphics")}else{$("#right").show();$(this).text("Hide Graphics")}});$("#addPlace").click(function(){addPlace()});$("#addEntity").click(function(){addEntity()});$("#addHypothesis").click(function(){addHypothesis()});$("#addFact").click(function(){addFact()});$("#btnFacts").click(function(){if($("#facts").is(":visible")){$(this).text("Show Facts");$("#facts").hide()}else{$(this).text("Hide Facts");$("#facts").show()}});$("#btnPredictions").click(function(){if(factPaper.generatedPredictions==null){factPaper.getPredictions();$(this).text("Hide Predictions")}else{$(this).text("Show Predictions");clearEverything()}});$("#btnReset").click(function(){var a=getQueryParams().model,b="../includes/php/resetModel.php";confirm("Are you sure? This will delete all places, entities, hypotheses and facts associted with this model, and CANNOT BE UNDONE.")&&$.post(b,{model:a},function(a){console.log(a);clearEverything()})});$("#zoomIn").click(function(){zoomIn()});$("#zoomReset").click(function(){zoomReset()});$("#zoomOut").click(function(){zoomOut()})}function closeClickEvents(){$(".deleteBtn").live("click",function(){var a=$(this).parent(),b=$("#myModal"),c=$("<a />").addClass("close-reveal-modal");c.html("&#215;");var d=$("<div />").addClass("item"),e=$("<p />").text("Are you sure you want to delete this element? This cannot be undone."),f=$("<input />").attr("type","button").val("Delete");f.addClass("del");d.append(f);var g=a.clone();d.append(g);b.html(e);b.append(d);b.append(c);b.reveal({animation:"none"});f.click(function(){deleteItem(g.attr("id"))})})}function locationPicker(){$("div.row span.location").live("click",function(a){a.preventDefault();var b=$(this),c="../includes/php/doQuery.php",d="SELECT * FROM entity WHERE kind=:kind",e={":kind":"place"};$.post(c,{query:d,data:e},function(a){})})}function addPlace(){var a=$("#myModal"),b=$("<h1 />").text("Add a Place");a.html(b);var c=$("<div />").addClass("item"),d=$("<a />").addClass("close-reveal-modal");d.html("&#215;");a.append(d);var e=$("<input >").attr({name:"name",type:"text",placeholder:"Name",required:"true"}),f=$("<select />").attr({name:"location",required:"true"});f.append($("<option />").text("").val(0));var g=$("<span />").text("in"),h=$("<input />").attr("type","button").val("Add Place");c.append(e).append(g).append(f).append(h);var i=getQueryParams().model,j="SELECT * FROM entity WHERE kind=:kind AND model=:model ORDER BY name",k={":kind":"place",":model":i};$.post(modelPaper.qUrl,{data:k,query:j},function(a){for(var b in a){var c=a[b],d=$("<option />").text(c.name).val(c.id);f.append(d)}});a.append(c);a.reveal({animation:"none"});e.focus();h.click(function(){var b=e.val(),c=f.val(),d="place";saveEntity(b,c,d,getQueryParams().model);$(a).find("a").click()})}function addEntity(){var a=$("#myModal"),b=$("<h1 />").text("Add an Entity");a.html(b);var c=getQueryParams().model,d=$("<div />").addClass("item"),e=$("<a />").addClass("close-reveal-modal");e.html("&#215;");a.append(e);var f=$("<span />").text("in"),g=$("<input >").attr({name:"name",type:"text",placeholder:"Name",required:"true"}),h=$("<select />").attr({name:"location",required:"true"}),i=$("<span />").text("is"),j=$("<select />").attr({name:"kind",required:"true"}),k=$("<option />").val("stable").text("stable"),l=$("<option />").val("transient").text("transient");j.append(k).append(l);var m=$("<input />").attr("type","button").val("Add Entity");d.append(g).append(f).append(h).append(i).append(j).append(m);var n="SELECT * FROM entity WHERE kind=:kind AND model=:model ORDER BY name",o={":kind":"place",":model":c};$.post(modelPaper.qUrl,{data:o,query:n},function(a){for(var b in a){var c=a[b],d=$("<option />").text(c.name).val(c.id);h.append(d)}});a.append(d);a.reveal({animation:"none"});g.focus();m.click(function(){var b=g.val(),d=h.val(),e=j.val();saveEntity(b,d,e,c);$(a).find("a").click()})}function addHypothesis(){var a=$("#myModal"),b=$("<h1 />").text("Add a Hypothesis");a.html(b);var c=$("<div />").addClass("item"),d=$("<a />").addClass("close-reveal-modal");d.html("&#215;");a.append(d);var e=getQueryParams().model,f=$("<select />").attr("name","start"),g=$("<select />").attr("name","end"),h=$("<select />").attr("name","type");h.append($("<option />").text("increases").val("increases"));h.append($("<option />").text("decreases").val("decreases"));h.css("margin-left","1em");var i=$("<input />").attr("type","button").val("Add Hypothesis"),j=$("<span />").text("with"),k="SELECT DISTINCT e.id as id, e.name as name, f.name as loc FROM entity e, entity f WHERE e.location=f.id AND e.model=:id ORDER BY e.name",l={":id":e};$.post(modelPaper.qUrl,{data:l,query:k},function(a){for(var b in a){var c=a[b],d=c.name+" in "+c.loc,e=$("<option />").val(c.id).text(d);f.append(e);g.append(e.clone())}});c.append(f).append(h).append(j).append(g).append(i);a.append(c);a.reveal({animation:"none"});f.focus();i.click(function(){var b=f.val(),c=h.val(),d=g.val();saveHypothesis(b,c,d,e);$(a).find("a").click()})}function addFact(){var a=$("#myModal"),b=$("<h1 />").text("Add an Empirical Fact");a.html(b);var c=$("<div />").addClass("item"),d=$("<a />").addClass("close-reveal-modal").html("&#215;");a.append(d);var e=$("<select />").attr("name","start"),f=$("<select />").attr("name","end"),g=$("<select />").attr("name","type");g.append($("<option />").text("increases").val("increases"));g.append($("<option />").text("decreases").val("decreases"));g.append($("<option />").text("does not change").val("does not change"));g.css("margin-left","1em");var h=$("<input />").attr("type","button").val("Add Fact"),i=$("<span />").text("with"),j="SELECT DISTINCT e.id as id, e.name as name, f.name as loc FROM entity e, entity f WHERE e.location=f.id AND e.model=:id AND e.kind <> :kind",k={":id":getQueryParams().model,":kind":"place"};$.post(modelPaper.qUrl,{data:k,query:j},function(a){for(var b in a){var c=a[b],d=c.name+" in "+c.loc,g=$("<option />").val(c.id).text(d);e.append(g);f.append(g.clone())}});c.append(e).append(g).append(i).append(f).append(h);a.append(c);a.reveal({animation:"none"});e.focus();h.click(function(){var b=e.val(),c=g.val(),d=f.val(),h=getQueryParams().model;saveFact(b,c,d,h);$(a).find("a").click()})}function zoomIn(){zoom=1.1;zoomTimes++;redrawEverything()}function zoomOut(){zoom=.9;zoomTimes++;redrawEverything()}function zoomReset(){modelPaper.resetZoom();factPaper.resetZoom()}function redrawEverything(){modelPaper.redraw();factPaper.redraw()}function clearEverything(){showFacts=$("#facts").is(":visible");$("#btnFacts").html("Show Facts");$("#facts").show();$("#right, #facts, div.group > div").html("");$("#predictions").remove();modelPaper=initCanvas();factPaper=initFacts()}$(document).ready(function(){menuClickEvents();closeClickEvents();locationPicker();textEvents();$("#right, #facts").click(function(){$("#left").is(":visible")&&$("#btnText").click()});$(document).keydown(function(a){if(a.keyCode==187&&a.metaKey==1){a.preventDefault();zoomIn();return!1}if(a.keyCode==189&&a.metaKey==1){a.preventDefault();zoomOut();return!1}if(a.keyCode==48&&a.metaKey==1){a.preventDefault();zoomReset();return!1}})});$.fn.saveChanges=function(){var a=$(this).parent(),b=parseInt(a.attr("id").replace("r","")),c=$(this).text().trim(),d=modelPaper.allShapes[b];d.name=c;d.text.attr("text",c);d.save();var e=factPaper.allShapes[b];e.name=c;e.text.attr("text",c)};