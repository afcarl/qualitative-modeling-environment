Raphael.fn.link=function(a,b,c,d){var e=this.line(b,c);e.id=a;e.start=b;e.end=c;e.kind=d;d=d.replace(" ","");e.arrowSize=6;e.strokeSize=2;e.attr({stroke:this.colors[d+"Stroke"],opacity:1,"stroke-width":e.strokeSize+"px"});e.coords=function(){var a=this.attr("path");return{x1:a[0][1],y1:a[0][2],x2:a[1][1],y2:a[1][2]}};e.drawDot=function(){var a=this.paper.circle(this.coords().x1,this.coords().y1,5);a.attr({fill:this.paper.colors[d+"Stroke"],stroke:"transparent",opacity:.8});a.parent=this;a.transport=function(){this.parent.attr("opacity")>0&&this.attr("opacity")==0&&this.attr("opacity",.8);this.attr({cx:this.parent.coords().x1,cy:this.parent.coords().y1}).animateAlong(this.parent,1500,!1,function(){this.transport()})};this.dot=a;a.transport()};e.fadeOut=function(){this.oo=this.attr("opacity");this.attr("opacity",0);this.arrow.remove()};e.fadeIn=function(){this.attr("opacity",1)};e.redraw=function(){var a=this.paper.line(this.start,this.end);this.attr("path",a.attr("path"));this.toFront();this.start.toFront();this.start.text.toFront();this.end.toFront();this.end.text.toFront();this.drawArrow();a.remove()};e.highlight=function(a){this.start.highlight();this.end.highlight();this.attr({opacity:.25});this.arrow.attr({opacity:.25});if(this.selected!=null){this.selected.remove();this.selected=null}};e.select=function(a){this.start.select();this.end.select();this.attr({opacity:1});this.arrow.attr({opacity:1});this.selected=this.clone();this.selected.attr({"stroke-width":"8px",stroke:this.paper.colors[a+"Stroke"],opacity:.3});this.selected.toFront();this.toFront();this.start.toFront();this.start.text.toFront();this.end.toFront();this.end.text.toFront();this.label!=null&&this.label.toFront()};e.showLabel=function(a,b){var c=this.getTotalLength(),d=this.getPointAtLength(c/2+b),e=parseInt(a),f=this.paper.g.flag(15,15+e*30,a),g=f[0],h=f[1];g.attr({fill:this.paper.colors.placeStroke,stroke:"transparent",opacity:.6});h.attr({fill:"#fff",font:"14px Signika Negative"});g.text=h;this.paper.labels.push(f);this.label=f;return f};e.hideLabel=function(){if(this.label!=null){this.label.remove();this.label=null}};e.drawArrow=function(){if(this.arrow!=null){this.arrow.remove();this.arrow=null}var a=this.start,d=this.end,f=this.paper.center(b),g=this.paper.center(c),h=f.cx,i=f.cy,j=g.cx,k=g.cy,l=Math.atan2(h-j,i-k);l*=180/Math.PI;l<0&&(l=360+l);l+=180;var m=this.getTotalLength(),n=this.getPointAtLength(m/2),o=Math.tan(l)*this.start.attr("height")+Math.sin(l)*this.start.attr("width"),p=this.getPointAtLength(m-o),q=this.paper.g.triangle(n.x,n.y,e.arrowSize);q.translate(0,1.5);q.rotate(-1*l,!0);q.attr({fill:this.paper.colors[this.kind+"Stroke"],stroke:"transparent"});this.arrow=q};e.mouseover(function(a){var b=this.id,c=$("#l"+b);c.addClass("highlight")});e.mouseout(function(a){var b=this.id,c=$("#l"+b);c.removeClass("highlight")});e.drawArrow();return e};Raphael.fn.drawLinks=function(a){this.allLinkData=a;this.allLinkSet=this.set();for(var b in a){var c=a[b],d=parseInt(c.start),e=parseInt(c.end),f=parseInt(c.id);d=this.allShapes[d];e=this.allShapes[e];var g=this.link(f,d,e,c.type);this.allLinks[f]=g;this.allLinkSet.push(g);this.allHypotheses[f]=g;d.links.push(g);e.links.push(g);d.toFront();d.text.toFront();e.toFront();e.text.toFront();if(!this.showFacts){this.addLink(g);var h=d.name+"@"+d.parent.name,i=e.name+"@"+e.parent.name,j=h+"_"+i,k=i+"_"+h;j=j.toLowerCase();k=k.toLowerCase();this.relLinks[j]=g;this.relLinks[k]=g}}};Raphael.fn.getLinks=function(){var a="SELECT * FROM link WHERE model=:model",b={":model":this.model},c=this;$.post(this.qUrl,{query:a,data:b},function(a){c.drawLinks(a);$("#facts").hide(0)})};