Raphael.fn.center=function(a){var b=a.attr("x"),c=a.attr("y"),d=a.attr("width"),e=a.attr("height"),f=b+d/2,g=c+e/2;return{cx:f,cy:g}};Raphael.fn.anchors=function(a){var b={x:a.attr("x"),y:a.attr("y")},c={x:this.center(a).cx,y:a.attr("y")},d={x:a.attr("x")+a.attr("width"),y:a.attr("y")},e={x:a.attr("x")+a.attr("width"),y:this.center(a).cy},f={x:a.attr("x")+a.attr("width"),y:a.attr("y")+a.attr("height")},g={x:this.center(a).cx,y:a.attr("y")+a.attr("height")},h={x:a.attr("x"),y:a.attr("y")+a.attr("height")},i={x:a.attr("x"),y:this.center(a).cy};return{nw:b,n:c,ne:d,e:e,se:f,s:g,sw:h,w:i}};Raphael.fn.message=function(a){var b=14,c=this.text(this.width/2,b,a),d=a.length*b/2+b,e=2.5*b,f=this.width/2-d/2,g=b/-2,h=this.rect(f,g,d,e,b/2);c.attr({font:b+"px Signika Negative"});h.attr({fill:"#ffc40d",stroke:"transparent"});h.text=c;h.toFront();c.toFront();return h};Raphael.fn.line=function(a,b){var c=this.center(a).cx,d=this.center(a).cy,e=this.center(b).cx,f=this.center(b).cy,g=this.path("M"+c+","+d+","+e+","+f);g.coords={x1:c,y1:d,x2:e,y2:f};return g};Raphael.fn.triangle=function(a,b){var c="M0,0,"+b*2+",0,"+b+","+b+" z",d=this.path(c);return d};Raphael.fn.fadeOut=function(a){var b=.05;this.highlighted=a;for(var c in this.allShapes){var d=this.allShapes[c];if(d.kind=="place")continue;d.attr({opacity:b});d.text.attr({opacity:b})}for(var e in this.allLinks){var f=this.allLinks[e];f.attr({opacity:b});f.arrow.attr({opacity:b});f.hideLabel();if(f.selected!=null){f.selected.remove();f.selected=null}}this.faded=!0};Raphael.fn.fadeIn=function(){var a=1;this.highlighted=null;this.labels!=null&&this.labels.remove();for(var b in this.allShapes){var c=this.allShapes[b];if(c.kind=="place")continue;c.attr({opacity:a});c.text.attr({opacity:a})}for(var d in this.allLinks){var e=this.allLinks[d];e.animate({opacity:a},500,">");e.arrow!=null&&e.arrow.attr({opacity:a});e.hideLabel!=null&&e.hideLabel();if(e.selected!=null){e.selected.remove();e.selected=null}}this.faded=!1};Raphael.fn.trapezoid=function(a,b){var c=a.attr("x"),d=a.attr("y"),e=a.attr("width"),f=a.attr("height"),g=c,h,i;if(b=="increases"){h=g+e;i=h}else{h=g;i=h+e}var j=d+a.attr("r"),k=f/2,l=d-k+a.attr("r"),m={x:g,y:j},n={x:h,y:l},o={x:i,y:j},p=this.buildPath([m,n,o]);p.attr({fill:this.colors[a.kind+"Fill"],stroke:this.colors[a.kind+"Stroke"],"stroke-width":"0px",opacity:1});return p};Raphael.fn.outline=function(a,b){var c=a.assoc[0],d=c.attr("path"),e=d[0][1],f=d[1][1],g=d[2][1],h=d[0][2],i=d[1][2],j=d[2][2],k={x:a.attr("x"),y:a.attr("y")+a.attr("height")},l={x:a.attr("x"),y:a.attr("y")},m={x:f,y:i},n={x:g,y:j},o={x:g,y:a.attr("y")+a.attr("height")},p=this.buildPath([k,l,m,n,o]);return p};Raphael.fn.buildPath=function(a){var b="M";b+=a[0].x+","+a[0].y;var c;for(c=1;c<a.length;c++)b+=","+a[c].x+","+a[c].y;b+="z";return this.path(b)};Raphael.fn.redraw=function(){var a=this;for(var b in this.allLinks){var c=this.allLinks[b];c.fadeOut();c.arrowSize*=zoom;c.strokeSize*=zoom;c.attr("stroke-width",c.strokeSize+"px")}for(var b in this.allShapes){var d=this.allShapes[b],e=d.attr("x"),f=d.attr("y"),g=d.attr("width"),h=d.attr("height");if(zoomTimes==1){d.zx=e;d.zy=f;d.zh=h;d.zw=g}d.attr({x:e*zoom,y:f*zoom,width:g*zoom,height:h*zoom});if(d.handle){var i=d.handle.attr("cx"),j=d.handle.attr("cy"),k=d.handle.attr("r");if(zoomTimes==1){d.handle.zx=i;d.handle.zy=j;d.handle.zr=k}d.handle.attr({cx:i*zoom,cy:j*zoom,r:k*zoom})}if(d.text){var l=d.text.attr("x"),m=d.text.attr("y"),n=d.text.attr("font").match(/^.*px/)[0].replace("px","");n=parseFloat(n);if(zoomTimes==1){d.text.zx=l;d.text.zy=m;d.text.zf=n}d.text.attr({x:l*zoom,y:m*zoom,font:n*zoom+"px Signika Negative"})}}for(var b in this.allLinks){var c=this.allLinks[b];c.fadeIn();c.redraw()}};Raphael.fn.resetZoom=function(){var a=this;if(zoom==1&&zoomTimes==0)return!1;for(var b in this.allLinks){var c=this.allLinks[b];c.fadeOut();c.arrowSize=6;c.strokeSize=2;c.attr("stroke-width",c.strokeSize+"px")}for(var b in this.allShapes){var d=this.allShapes[b];d.attr({x:d.zx,y:d.zy,width:d.zw,height:d.zh});d.handle&&d.handle.attr({cx:d.handle.zx,cy:d.handle.zy,r:d.handle.zr});d.text&&d.text.attr({x:d.text.zx,y:d.text.zy,font:d.text.zf+"px Signika Negative"})}for(var b in this.allLinks){var c=this.allLinks[b];c.fadeIn();c.redraw()}};var fadeEasing="ease-in-out",fadeTiming=250,fadeOpacity=.15;Raphael.el.fadeOut=function(){var a=this.id,b=0;this.animate({opacity:fadeOpacity},fadeTiming,fadeEasing);this.text.animate({opacity:fadeOpacity},fadeTiming,fadeEasing);if(this.paper===modelPaper){factPaper.allShapes[a].disabled=!0;factPaper.allShapes[a].fadeOut(!0)}for(b=0;b<this.links.length;b++){$('input[name="chkLink'+this.links[b].id+'"]').removeAttr("checked");this.links[b].end.disabled=!0;this.links[b].start.disabled=!0;this.links[b].animate({opacity:fadeOpacity},fadeTiming,fadeEasing).arrow.animate({opacity:fadeOpacity},fadeTiming,fadeEasing)}};Raphael.el.fadeIn=function(){var a=this.id,b=0;this.animate({opacity:1},fadeTiming,fadeEasing);this.text.animate({opacity:1},fadeTiming,fadeEasing);if(this.paper==modelPaper){delete factPaper.allShapes[a].disabled;factPaper.allShapes[a].fadeIn(!0)}for(b=0;b<this.links.length;b++){$('input[name="chkLink'+this.links[b].id+'"]').attr("checked","checked");this.links[b].animate({opacity:1},fadeTiming,fadeEasing).arrow.animate({opacity:1},fadeTiming,fadeEasing)}};Raphael.el.fadeInLink=function(){this.animate({opacity:1},fadeTiming,fadeEasing).arrow.animate({opacity:1},fadeTiming,fadeEasing)};Raphael.el.fadeOutLink=function(){this.animate({opacity:fadeOpacity},fadeTiming,fadeEasing).arrow.animate({opacity:fadeOpacity},fadeTiming,fadeEasing)};