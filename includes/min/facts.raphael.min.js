Raphael.fn.fact=function(a,b,c,d){if(c==null){var e=this.trapezoid(b,d);e.start=b;e.kind=d;e.fadeOut=function(){this.oo=this.attr("opacity");this.attr("opacity",0)};e.fadeIn=function(){this.attr("opacity",1)};e.redraw=function(){var a=this.paper.trapezoid(this.start,this.kind);this.attr("path",a.attr("path"));a.remove();this.toFront()};e.prediction=null;e.click(function(){clickPred(this.prediction)});b.assoc.push(e);return e}var f=this.line(b,c);f.id=a;f.start=b;f.end=c;f.kind=d;d=d.replace(/ /g,"");f.attr({stroke:this.colors[d+"Stroke"],opacity:1,"stroke-width":"2px"});f.coords=function(){var a=this.attr("path");return{x1:a[0][1],y1:a[0][2],x2:a[1][1],y2:a[1][2]}};f.drawDot=function(){var a=this.paper.circle(this.coords().x1,this.coords().y1,5);a.attr({fill:this.paper.colors[d+"Stroke"],stroke:"transparent",opacity:.8});a.parent=this;a.transport=function(){this.parent.attr("opacity")>0&&this.attr("opacity")==0&&this.attr("opacity",.8);this.attr({cx:this.parent.coords().x1,cy:this.parent.coords().y1}).animateAlong(this.parent,1500,!1,function(){this.transport()})};this.dot=a;a.transport()};f.fadeOut=function(){this.oo=1;this.attr("opacity",0);this.arrow!=null&&this.arrow.remove()};f.fadeIn=function(){this.attr("opacity",this.oo)};f.redraw=function(){if(this.end!=null){var a=this.paper.line(this.start,this.end);this.attr("path",a.attr("path"));a.remove()}this.drawArrow();this.toFront();this.start.toFront();this.start.text.toFront();if(this.end!=null){this.end.toFront();this.end.text.toFront()}};f.drawArrow=function(){if(this.arrow!=null){this.arrow.remove();this.arrow=null}var a=this.getTotalLength(),d=this.getPointAtLength(a/2),e=this.paper.g.triangle(d.x,d.y,6),f=this.start,g=this.end,h=this.paper.center(b),i=this.paper.center(c),j=h.cx,k=h.cy,l=i.cx,m=i.cy,n=d.alpha,o=Math.atan2(j-l,k-m);o*=180/Math.PI;o<0&&(o=360+o);o+=180;e.translate(0,1.5);e.rotate(-1*o,!0);var p=this.kind.replace(/ /g,"");e.attr({fill:this.paper.colors[p+"Stroke"],stroke:"transparent"});this.arrow=e};f.drawArrow();return f};Raphael.fn.drawFacts=function(a){this.allLinkData=a;this.allLinkSet=this.set();for(var b in a){var c=a[b],d=parseInt(c.start),e=parseInt(c.end),f=parseInt(c.id);d=this.allShapes[d];e=this.allShapes[e];var g=this.fact(f,d,e,c.type);this.allLinks[f]=g;this.allLinkSet.push(g);d.toFront();d.text.toFront();if(e!=null){d.links.push(g);e.links.push(g);e.toFront();e.text.toFront()}this.addFact(g)}};Raphael.fn.getFacts=function(){var a="SELECT * FROM fact WHERE model=:model",b={":model":this.model},c=this;$.post(this.qUrl,{query:a,data:b},function(a){c.drawFacts(a)})};