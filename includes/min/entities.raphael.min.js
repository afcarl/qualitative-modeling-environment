Raphael.fn.entity=function(a,b,c,d,e,f,g){var h=14;d*=zoom;e*=zoom;f*=zoom;g*=zoom;var i=this.text(d,e,b),j=i.getBBox().width+3.5*h*zoom,k=i.getBBox().height+h*zoom,l=d,m=e,n=this.rect(l,m,j,k,0);n.id=a;n.name=b;n.kind=c;i.attr({fill:"#fff",font:h*zoom+"px Signika Negative",x:this.center(n).cx,y:this.center(n).cy});n.attr({opacity:1,fill:this.colors[c+"Fill"],stroke:this.colors[c+"Stroke"],"stroke-width":"0px"});n.text=i;i.parent=n;n.links=this.set();n.start=entityDrag().start;n.move=entityDrag().move;n.end=entityDrag().end;n.save=saveShape;n.drag(n.move,n.start,n.end);n.toFront();i.toFront();n.getPair=function(){var a;this.paper.showFacts?a=modelPaper.allShapes[this.id]:a=factPaper.allShapes[this.id];return a};n.highlight=function(){this.attr({opacity:.25});this.text.attr({opacity:.25})};n.select=function(){this.attr({opacity:1});this.text.attr({opacity:1})};n.assoc=this.set();return n};Raphael.fn.deleteEntities=function(){var a=this;for(var b in this.allLinks){var c=this.allLinks[b];c.arrow.remove();c.remove();delete this.allLinks[b]}delete this.allLinks;this.allLinks=new Array;for(var b in this.allEntities){var d=this.allEntities[b];d.text.remove();d.handle&&d.handle.remove();d.remove();delete this.allShapes[b]}};Raphael.fn.drawEntities=function(a){for(var b in a){var c=a[b];c.x=parseInt(c.x);c.y=parseInt(c.y);c.width=parseInt(c.width);c.height=parseInt(c.height);var d=parseInt(c.location),e=parseInt(c.id);if(d==-1)return!1;var f=this.entity(e,c.name,c.kind,c.x,c.y,c.width,c.height);this.allShapes[e]=f;this.allEntities[e]=f;if(d!=0){f.parent=this.allShapes[d];this.allShapes[d].children.push(f);if(this.showFacts){var g=this.allShapes[d].name.toLowerCase();this.relShapes[f.name.toLowerCase()+"@"+g]=f}}this.showFacts||this.addEntity(f)}};Raphael.fn.getEntities=function(){var a="SELECT e.*, p.* FROM entity e, placement p WHERE e.id=p.entity AND e.kind<>:kind AND e.model=:model",b={":kind":"place",":model":this.model},c=this;$.post(this.qUrl,{query:a,data:b},function(a){c.drawEntities(a);c.showFacts==0?c.getLinks():c.getFacts()})};